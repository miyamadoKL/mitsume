# ユーザー管理

ユーザー管理は、システム内のユーザー一覧を確認し、各ユーザーにロールを割り当てる機能です。
この機能は **管理者（admin ロールを持つユーザー）** のみがアクセスできます。

## アクセス方法

1. サイドバーの **Admin** セクションを展開します
2. **User Management** をクリックします

> **注意**: この画面は管理者のみがアクセスできます。一般ユーザーはアクセスできません。

## 画面構成

```
┌─────────────────────────────────────────────────────────────┐
│  User Management                                            │
├─────────────────────────────────────────────────────────────┤
│  ┌───────────────────────────────────────────────────────┐  │
│  │ 👥 Users                                               │  │
│  ├───────┬──────────────┬──────────┬─────────┬──────────┤  │
│  │ Name  │ Email        │ Provider │ Roles   │ Actions  │  │
│  ├───────┼──────────────┼──────────┼─────────┼──────────┤  │
│  │ 田中  │ tanaka@...   │ google   │ 🛡️admin │ [Manage] │  │
│  │ [You] │              │          │         │          │  │
│  ├───────┼──────────────┼──────────┼─────────┼──────────┤  │
│  │ 佐藤  │ sato@...     │ password │ 🛡️analyst│ [Manage] │  │
│  ├───────┼──────────────┼──────────┼─────────┼──────────┤  │
│  │ 鈴木  │ suzuki@...   │ google   │ No roles│ [Manage] │  │
│  └───────┴──────────────┴──────────┴─────────┴──────────┘  │
└─────────────────────────────────────────────────────────────┘
```

## ユーザー一覧

登録されているすべてのユーザーが一覧表示されます。

| 列 | 説明 |
|-----|------|
| **Name** | ユーザーの表示名 |
| **Email** | メールアドレス |
| **Auth Provider** | 認証方法（password / google） |
| **Roles** | 割り当てられているロール |
| **Actions** | 操作ボタン |

### 認証プロバイダー

| プロバイダー | 説明 |
|-------------|------|
| **password** | メールアドレスとパスワードで登録したユーザー |
| **google** | Google OAuth でログインしたユーザー |

### 自分のユーザー

自分のユーザーには **[You]** バッジが表示されます。

## ロールの割り当て

ユーザーにロールを割り当てることで、そのユーザーがアクセスできるカタログを制御できます。

### ロール割り当ての手順

1. ロールを割り当てたいユーザーの行で **Manage Roles** ボタンをクリックします
2. ロール選択ダイアログが開きます
3. 割り当てたいロールのチェックボックスをオンにします
4. 削除したいロールのチェックボックスをオフにします
5. **Save** をクリックして保存します

### ロールの種類

| バッジ色 | ロール種別 | 説明 |
|---------|----------|------|
| 🟡 黄色 | System | システム定義ロール（admin） |
| 🟢 緑色 | Custom | ユーザー定義ロール |

### admin ロール

- **admin** ロールはシステム定義のロールです
- admin ロールを持つユーザーは、すべてのカタログにアクセスできます
- admin ロールを持つユーザーは、管理画面にアクセスできます

> **重要**: 自分自身の admin ロールを削除することはできません。これは誤操作による管理者の喪失を防ぐための安全機能です。

## ロールとカタログ権限

ロールを割り当てることで、そのロールに紐づくカタログへのアクセス権限が付与されます。

### 例: 営業チームのアクセス制御

1. **ロールの作成**（Role Management で実施）
   - ロール名: `sales`
   - カタログ: `sales_catalog`, `shared_catalog`

2. **ユーザーへの割り当て**
   - 営業チームメンバーに `sales` ロールを割り当て

3. **結果**
   - 営業チームメンバーは `sales_catalog` と `shared_catalog` にのみアクセス可能
   - 他のカタログ（`hr_catalog` など）にはアクセス不可

## 複数ロールの割り当て

1 人のユーザーに複数のロールを割り当てることができます。

- ユーザーは、割り当てられたすべてのロールのカタログにアクセスできます
- 権限は加算的（additive）に適用されます

### 例

| ユーザー | ロール | アクセス可能なカタログ |
|---------|--------|----------------------|
| 田中 | admin | すべてのカタログ |
| 佐藤 | sales, marketing | sales_catalog, marketing_catalog, shared_catalog |
| 鈴木 | sales | sales_catalog, shared_catalog |

## 状態表示

### ローディング状態

データ読み込み中はスケルトンローダーが表示されます。

### エラー状態

読み込みに失敗した場合:
- エラーメッセージが表示されます
- **Retry** ボタンで再読み込みできます

## ベストプラクティス

### ロール設計

1. **最小権限の原則**: ユーザーには必要最小限のロールのみを割り当てる
2. **チームベース**: 部署やチームごとにロールを設計する
3. **admin の制限**: admin ロールは本当に必要なユーザーのみに割り当てる

### 定期的な見直し

1. **退職者の確認**: 退職したユーザーのロールを削除
2. **異動者の対応**: 異動したユーザーのロールを更新
3. **不要なロールの削除**: 使われていないロールを整理

## 関連ドキュメント

- [ロール管理](./role-management.md) - ロールの作成とカタログ権限の設定
