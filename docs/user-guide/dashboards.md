# ダッシュボード

ダッシュボードは、複数のクエリ結果をチャートやテーブルで可視化し、一覧表示するための機能です。
ドラッグ&ドロップでレイアウトを自由にカスタマイズできます。

## 画面構成

### ダッシュボード一覧

```
┌─────────────────────────────────────────────────────────────┐
│  Dashboards                              [+ New Dashboard]  │
├─────────────────────────────────────────────────────────────┤
│  ┌─────────────────────┐  ┌─────────────────────┐          │
│  │ 📊 売上ダッシュボード │  │ 📊 ユーザー分析     │          │
│  │ Owner               │  │ Can Edit            │          │
│  │ 更新: 2024/01/15    │  │ 更新: 2024/01/14    │          │
│  │              [🗑️]   │  │                     │          │
│  └─────────────────────┘  └─────────────────────┘          │
└─────────────────────────────────────────────────────────────┘
```

### ダッシュボード詳細

```
┌─────────────────────────────────────────────────────────────┐
│  ← [ダッシュボード名]    [Edit] [Refresh] [Share] [Export]  │
│  [Auto Refresh: Off ▼]                                      │
├─────────────────────────────────────────────────────────────┤
│  パラメータ: [期間 ▼] [カテゴリ ▼]              [Apply]    │
├─────────────────────────────────────────────────────────────┤
│  ┌─────────────────────────┐  ┌─────────────────────────┐  │
│  │     売上推移（折れ線）    │  │   カテゴリ別売上（円）   │  │
│  │  📈                      │  │  🥧                      │  │
│  └─────────────────────────┘  └─────────────────────────┘  │
│  ┌─────────────────────────────────────────────────────────┐│
│  │     注文一覧（テーブル）                                  ││
│  │  📋                                                      ││
│  └─────────────────────────────────────────────────────────┘│
└─────────────────────────────────────────────────────────────┘
```

## 基本的な使い方

### ダッシュボードの作成

1. サイドバーから **Dashboards** をクリックします
2. **New Dashboard** ボタンをクリックします
3. ダイアログで以下を入力します:
   - **名前**: ダッシュボードの名前（必須）
   - **説明**: ダッシュボードの説明（任意）
4. **Create** をクリックします
5. 新しいダッシュボードが開きます

### ウィジェットの追加

1. ダッシュボード画面で **Edit** ボタンをクリックして編集モードにします
2. **Add Widget** ボタンをクリックします
3. ダイアログで以下を設定します:
   - **名前**: ウィジェットの表示名
   - **保存クエリ**: データソースとなるクエリを選択
   - **チャートタイプ**: 表示形式を選択
4. **Add** をクリックします
5. ウィジェットがダッシュボードに追加されます

### レイアウトの変更

編集モードでは、ウィジェットのレイアウトを自由に変更できます。

#### ドラッグで移動
1. ウィジェットのヘッダー部分をクリック&ドラッグします
2. 配置したい位置にドロップします

#### リサイズ
1. ウィジェットの右下角にカーソルを合わせます
2. リサイズハンドルをドラッグしてサイズを変更します

### ダッシュボードの保存

編集後は必ず保存してください。

1. **Save** ボタンをクリックします
2. 変更が保存されます
3. 編集モードが終了します

## チャートタイプ

| タイプ | 説明 | 適した用途 |
|--------|------|-----------|
| **Bar Chart** | 棒グラフ | カテゴリ別の比較 |
| **Line Chart** | 折れ線グラフ | 時系列データの推移 |
| **Pie Chart** | 円グラフ | 構成比の表示 |
| **Area Chart** | 面グラフ | 累積データの推移 |
| **Scatter Chart** | 散布図 | 2変数の相関 |
| **Table** | テーブル | 詳細データの表示 |
| **Counter (KPI)** | カウンター | 単一の数値指標 |
| **Pivot Table** | ピボットテーブル | クロス集計 |
| **Text (Markdown)** | マークダウン | 説明テキストの表示 |

### チャート設定

各チャートタイプに応じた設定が可能です。

#### 軸の設定（棒・折れ線・面・散布図）
- **X軸**: 横軸に使用する列
- **Y軸**: 縦軸に使用する列（複数選択可）

#### 円グラフの設定
- **ラベル列**: 各セグメントのラベル
- **値列**: 各セグメントの値

#### カウンターの設定
- **値列**: 表示する数値の列
- **プレフィックス**: 数値の前に表示するテキスト（例: ¥）
- **サフィックス**: 数値の後に表示するテキスト（例: 件）

#### ピボットテーブルの設定
- **行**: 行ヘッダーに使用する列
- **列**: 列ヘッダーに使用する列
- **値**: 集計する値の列

## ウィジェットの操作

### ウィジェットの編集

1. 編集モードでウィジェットの設定アイコン（⚙️）をクリックします
2. 設定ダイアログが開きます
3. 設定を変更して **Save** をクリックします

### ウィジェットの削除

1. 編集モードでウィジェットの削除アイコン（🗑️）をクリックします
2. 確認ダイアログで **Delete** をクリックします

### 個別のリフレッシュ

各ウィジェットは個別にデータを更新できます。

1. ウィジェットのリフレッシュアイコン（🔄）をクリックします
2. クエリが再実行され、データが更新されます

## データの更新

### 手動更新

**Refresh** ボタンをクリックすると、すべてのウィジェットのデータが更新されます。

### 自動更新

ダッシュボードを自動的に更新する間隔を設定できます。

1. **Auto Refresh** ドロップダウンをクリックします
2. 更新間隔を選択します:
   - **Off**: 自動更新なし
   - **30s**: 30秒ごと
   - **1m**: 1分ごと
   - **5m**: 5分ごと
   - **10m**: 10分ごと
3. 選択した間隔でダッシュボードが自動更新されます

## パラメータ

ダッシュボードのクエリにパラメータを設定できます。

### パラメータの定義

保存クエリで `{{パラメータ名}}` 形式でパラメータを定義します。

```sql
SELECT * FROM orders
WHERE order_date >= DATE '{{start_date}}'
  AND category = '{{category}}'
```

### パラメータの使用

1. パラメータが設定されたクエリを使用するウィジェットを追加します
2. ダッシュボード上部にパラメータ入力欄が表示されます
3. パラメータ値を入力します
4. **Apply** ボタンをクリックします
5. すべてのウィジェットが新しいパラメータ値で更新されます

## 共有

### ダッシュボードの共有

1. **Share** ボタンをクリックします
2. 共有ダイアログが開きます
3. 共有先のユーザーとアクセス権限を設定します:
   - **View**: 閲覧のみ
   - **Edit**: 編集可能
4. **Share** をクリックします

### 公開設定

ダッシュボードを全ユーザーに公開できます。

1. 共有ダイアログで **Public** トグルをオンにします
2. ダッシュボードが全ユーザーから閲覧可能になります

### 権限レベル

| レベル | 閲覧 | 編集 | 削除 | 共有設定 |
|--------|-----|------|------|---------|
| Owner | ✓ | ✓ | ✓ | ✓ |
| Edit | ✓ | ✓ | - | - |
| View | ✓ | - | - | - |

## エクスポート

ダッシュボードを画像やPDFとしてエクスポートできます。

1. **Export** ボタンをクリックします
2. 形式を選択します:
   - **PNG**: 画像形式
   - **PDF**: PDF形式
3. ファイルがダウンロードされます

## 状態表示

### ローディング状態

ウィジェットのデータ読み込み中はスケルトンローダーが表示されます。

### エラー状態

クエリ実行に失敗した場合:
- エラーメッセージが表示されます
- **Retry** ボタンで再実行できます

### 空の状態

ウィジェットがない場合:
- 「Add widgets to get started」メッセージが表示されます
- **Add Widget** ボタンでウィジェットを追加できます

## ベストプラクティス

### レイアウト設計

1. **重要な指標を上部に**: KPI やサマリーを画面上部に配置
2. **関連するウィジェットをグループ化**: 同じテーマのウィジェットを近くに配置
3. **適切なサイズ**: 情報量に応じたウィジェットサイズを設定

### パフォーマンス

1. **クエリの最適化**: 重いクエリはダッシュボードの読み込みを遅くします
2. **ウィジェット数の適正化**: 多すぎるウィジェットは読み込み時間を増加させます
3. **自動更新の間隔**: 短すぎる間隔はサーバー負荷を増加させます

## 関連ドキュメント

- [保存クエリ](./saved-queries.md) - ウィジェットで使用するクエリの管理
- [サブスクリプション](./subscriptions.md) - ダッシュボードの定期配信
